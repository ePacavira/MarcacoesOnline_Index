<div class="utente-bg">
  <div class="utente-wrapper">
    <!-- Lado esquerdo: logo, progresso -->
    <div class="utente-left">
      <div class="utente-logo">CentroVita</div>
      <ul class="utente-steps">
        <li [class.active]="stepAtual() === 0">Registo</li>
        <li [class.active]="stepAtual() === 1">Dados Pessoais</li>
        <li [class.active]="stepAtual() === 2">Confirmação</li>
      </ul>
      <div class="utente-img">
        <img src="/public/logo.jpg" alt="CentroVita" />
      </div>
    </div>
    
    <!-- Lado direito: formulário -->
    <div class="utente-right">
      <div class="utente-header">
        <button type="button" (click)="onCancel()" class="utente-back-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <div class="utente-header-content">
          <h2 class="utente-title">Registo de Novo Utente</h2>
          <p class="utente-subtitle">Preencha os seus dados para criar a sua conta</p>
        </div>
      </div>
      
      <form [formGroup]="registoForm" (ngSubmit)="onSubmit()" class="utente-form" (ngModelChange)="onFormChange()">
        <!-- Número de Utente (não editável) -->
        <label for="numeroUtente">Número de Utente</label>
        <div class="utente-number-display">{{ registoForm.get('numeroUtente')?.value || 'A ser gerado automaticamente' }}</div>

        <!-- Nome Completo -->
        <label for="nomeCompleto">Nome Completo</label>
        <input id="nomeCompleto" type="text" formControlName="nomeCompleto" placeholder="Nome completo" (focus)="onFormFieldInteraction()" (input)="onFormChange()" />
        @if (registoForm.controls['nomeCompleto'].errors?.['required']) {
          <p class="error">Nome completo é obrigatório.</p>
        }

        <!-- Género e Data de Nascimento -->
        <div class="form-row">
          <div class="form-group">
            <label for="genero">Género</label>
            <select id="genero" formControlName="genero" (focus)="onFormFieldInteraction()" (change)="onFormChange()">
              <option value="">-- selecione --</option>
              <option value="Masculino">Masculino</option>
              <option value="Feminino">Feminino</option>
              <option value="Outro">Outro</option>
              <option value="PrefiroNaoIndicar">Prefiro não indicar</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dataNascimento">Data de Nascimento</label>
            <input id="dataNascimento" type="date" formControlName="dataNascimento" (focus)="onFormFieldInteraction()" (change)="onFormChange()" />
            @if (registoForm.controls['dataNascimento'].errors?.['required']) {
              <p class="error">Data de nascimento é obrigatória.</p>
            }
          </div>
        </div>

        <!-- Email e Telemóvel -->
        <div class="form-row">
          <div class="form-group">
            <label for="email">Email</label>
            <input id="email" type="email" formControlName="email" placeholder="seu@email.com" (focus)="onFormFieldInteraction()" (input)="onFormChange()" />
            @if (registoForm.controls['email'].errors?.['required']) {
              <p class="error">Email é obrigatório.</p>
            }
            @if (registoForm.controls['email'].errors?.['email']) {
              <p class="error">Formato de email inválido.</p>
            }
          </div>
          <div class="form-group">
            <label for="telemovel">Telemóvel</label>
            <input id="telemovel" type="tel" formControlName="telemovel" placeholder="Ex: 912345678" (focus)="onFormFieldInteraction()" (input)="onFormChange()" />
            @if (registoForm.controls['telemovel'].errors?.['required']) {
              <p class="error">Telemóvel é obrigatório.</p>
            }
            @if (registoForm.controls['telemovel'].errors?.['pattern']) {
              <p class="error">Formato de telemóvel inválido.</p>
            }
          </div>
        </div>

        <!-- Morada -->
        <label for="rua">Rua / Avenida / Praça</label>
        <input id="rua" type="text" formControlName="rua" placeholder="Nome da rua" (focus)="onFormFieldInteraction()" (input)="onFormChange()" />

        <!-- Fotografia -->
        <label for="fotografia">Fotografia</label>
        <input id="fotografia" type="file" (focus)="onFormFieldInteraction()" (change)="onFileSelected($event); onFormChange()" class="file-input" />
        @if (imagePreview) {
          <img [src]="imagePreview" alt="Pré‑visualização" class="image-preview" />
        }

        <button type="submit" class="utente-btn" [disabled]="registoForm.invalid">Criar Conta</button>
      </form>
    </div>
  </div>
</div>