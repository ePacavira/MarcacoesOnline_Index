<div class="marcacoes-container">
  <!-- Formulário de Nova Marcação -->
  <form *ngIf="showForm" [formGroup]="marcacaoForm" class="marcacao-form space-y-6 mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Data Início *</label>
        <input 
          type="date" 
          formControlName="dataInicioPreferida"
          [min]="minDate"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00548d] focus:border-transparent">
        <div *ngIf="marcacaoForm.get('dataInicioPreferida')?.invalid && marcacaoForm.get('dataInicioPreferida')?.touched" class="text-red-500 text-sm mt-1">
          Selecione a data de início
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Hora Início *</label>
        <select 
          formControlName="horaInicioPreferida"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00548d] focus:border-transparent">
          <option value="">Selecione um horário</option>
          <option *ngFor="let slot of availableSlots" [value]="slot">{{ slot }}</option>
        </select>
        <div *ngIf="marcacaoForm.get('horaInicioPreferida')?.invalid && marcacaoForm.get('horaInicioPreferida')?.touched" class="text-red-500 text-sm mt-1">
          Selecione o horário de início
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Data Fim *</label>
        <input 
          type="date" 
          formControlName="dataFimPreferida"
          [min]="minDate"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00548d] focus:border-transparent">
        <div *ngIf="marcacaoForm.get('dataFimPreferida')?.invalid && marcacaoForm.get('dataFimPreferida')?.touched" class="text-red-500 text-sm mt-1">
          Selecione a data de fim
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Hora Fim *</label>
        <select 
          formControlName="horaFimPreferida"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00548d] focus:border-transparent">
          <option value="">Selecione um horário</option>
          <option *ngFor="let slot of availableSlots" [value]="slot">{{ slot }}</option>
        </select>
        <div *ngIf="marcacaoForm.get('horaFimPreferida')?.invalid && marcacaoForm.get('horaFimPreferida')?.touched" class="text-red-500 text-sm mt-1">
          Selecione o horário de fim
        </div>
      </div>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Observações</label>
      <textarea 
        formControlName="observacoes"
        rows="3"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00548d] focus:border-transparent"
        placeholder="Informações adicionais sobre a consulta..."></textarea>
    </div>
    <div class="flex justify-end">
      <button type="button" (click)="cancelarForm()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 mr-2">Cancelar</button>
      <button type="submit" (click)="salvarMarcacao()" [disabled]="marcacaoForm.invalid" class="px-6 py-3 bg-[#00548d] text-white rounded-lg hover:bg-[#0077cc] disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">Salvar Marcação</button>
    </div>
  </form>
  <!-- Header da página -->
  <div class="marcacoes-header">
    <div class="marcacoes-header-content">
      <h1 class="marcacoes-title">Gestão de Marcações</h1>
      <p class="marcacoes-subtitle">Visualize e gerencie todas as marcações de consultas</p>
    </div>
    <div class="marcacoes-header-actions">
      <button class="marcacoes-add-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Nova Marcação
      </button>
    </div>
  </div>

  <!-- Filtros e pesquisa -->
  <div class="marcacoes-filters">
    <div class="marcacoes-search">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
      <input 
        type="text" 
        placeholder="Pesquisar marcações..." 
        class="marcacoes-search-input"
        [(ngModel)]="searchTerm"
      >
    </div>
    
    <div class="marcacoes-filter-dropdown">
      <button (click)="toggleDropdown()" class="marcacoes-filter-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
          </svg>
        {{ triggerButtonText }}
        <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>

        @if (isDropdownOpen) {
        <div class="marcacoes-dropdown-menu">
            @for (option of filterOptions; track option.id) {
            <label class="marcacoes-dropdown-item">
              <input 
                [id]="option.id" 
                type="radio" 
                [value]="option.value" 
                name="filter-radio"
                [(ngModel)]="selectedFilterValue" 
                (change)="selectFilter(option)"
              >
              <span class="radio-custom"></span>
                  {{ option.label }}
                </label>
            }
        </div>
        }
    </div>
  </div>

  <!-- Estatísticas -->
  <div class="marcacoes-stats">
    <div class="stat-card">
      <div class="stat-icon pending">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-number">{{ getPendingCount() }}</h3>
        <p class="stat-label">Pendentes</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon confirmed">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-number">{{ getConfirmedCount() }}</h3>
        <p class="stat-label">Confirmadas</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon completed">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 13l4 4L19 7"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-number">{{ getCompletedCount() }}</h3>
        <p class="stat-label">Realizadas</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon total">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3 class="stat-number">{{ marcacoes.length }}</h3>
        <p class="stat-label">Total</p>
      </div>
    </div>
  </div>

  <!-- Lista de marcações -->
  <div class="marcacoes-list">
    @if (marcacoes.length === 0) {
      <div class="marcacoes-empty">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <h3>Nenhuma marcação encontrada</h3>
        <p>Comece criando uma nova marcação ou ajuste os filtros de pesquisa.</p>
      </div>
    } @else {
      @for (marcacao of getFilteredMarcacoes(); track marcacao.id) {
        <div class="marcacao-card">
          <div class="marcacao-header">
            <div class="marcacao-date">
              <div class="date-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M8 2v4m8-4v4M3 10h18M5 4h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2z"/>
                </svg>
              </div>
              <div class="date-info">
                <span class="date-range">{{ marcacao.dataInicioPreferida }} - {{ marcacao.dataFimPreferida }}</span>
                <span class="time-preference">{{ marcacao.horarioPreferido }}</span>
              </div>
            </div>
            <div class="marcacao-status">
              <span class="status-badge"
                [class.status-pending]="marcacao.estado === 'Pedido'"
                [class.status-confirmed]="marcacao.estado === 'Agendado'"
                [class.status-completed]="marcacao.estado === 'Realizado'"
              >
                {{ marcacao.estado }}
              </span>
            </div>
          </div>
          
          <div class="marcacao-content">
            @if (marcacao.observacoes) {
              <div class="marcacao-observations">
                <h4>Observações:</h4>
                <p>{{ marcacao.observacoes }}</p>
              </div>
            }
            
            @if (marcacao.actosClinicos && marcacao.actosClinicos.length > 0) {
              <div class="marcacao-actos">
                <h4>Actos Clínicos:</h4>
                <div class="actos-tags">
                  @for (acto of marcacao.actosClinicos; track acto.id) {
                    <span class="acto-tag">{{ acto.tipo }}</span>
                  }
                </div>
              </div>
            }
          </div>
          
          <div class="marcacao-actions">
            <button class="action-btn edit">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Editar
            </button>
            <button class="action-btn delete">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
              </svg>
              Excluir
          </button>
          </div>
        </div>
      }
    }
  </div>
</div>